<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.5.43" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Ryan Lima" />
<meta name="dcterms.date" content="2024-12-09" />

<title>Scraps</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>

<!-- htmldependencies:E3FAD763 -->

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <div id="quarto-toc-target"></div>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Scraps</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ryan Lima </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 9, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>

<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#regional-hydrologic-responses-to-treatment" id="toc-regional-hydrologic-responses-to-treatment">Regional Hydrologic Responses to Treatment</a>
  <ul>
  <li><a href="#water-yieldrunoff" id="toc-water-yieldrunoff">Water Yield/Runoff</a></li>
  <li><a href="#soil-moisture-and-drought-resilience" id="toc-soil-moisture-and-drought-resilience">Soil Moisture and Drought Resilience</a></li>
  <li><a href="#justification" id="toc-justification">Justification</a></li>
  <li><a href="#thinning-decreases-et-in-some-circumstances" id="toc-thinning-decreases-et-in-some-circumstances">thinning decreases ET in some circumstances</a></li>
  </ul></li>
  <li><a href="#sec-data-methods" id="toc-sec-data-methods">Data &amp; Methods</a>
  <ul>
  <li><a href="#weighted-suitability-workflow" id="toc-weighted-suitability-workflow">Weighted Suitability Workflow</a></li>
  </ul></li>
  <li><a href="#preliminary-results" id="toc-preliminary-results">Preliminary Results</a>
  <ul>
  <li><a href="#weighting" id="toc-weighting">Weighting</a></li>
  <li><a href="#overall-suitability" id="toc-overall-suitability">Overall Suitability</a></li>
  </ul></li>
  </ul>
</nav>
<p>The connection between forests and water supplies is well documented. Around 65% of surface water in the western states originates from forested lands, which cover just 29% of the land area <span class="citation" data-cites="brown_source_2005">[@brown_source_2005]</span>. The average annual precipitation in the Lower Colorado River Basin is about 330 <span class="math inline">\(mm\)</span>, and only about 10 <span class="math inline">\(mm\)</span> of that precipitation becomes streamflow, while much of the rest is lost to evapotranspiration <span class="citation" data-cites="zou_streamflow_2010">[@zou_streamflow_2010]</span>. Regional studies have found that up to 90% of annual precipitation in semi-arid forests is lost evapotranspiration <span class="citation" data-cites="dore_recovery_2012 ha_evapotranspiration_2015 yaseef_ecohydrology_2010 hibbert1979">[@dore_recovery_2012; @ha_evapotranspiration_2015; @yaseef_ecohydrology_2010; @hibbert1979]</span>. Sublimation has been shown to remove 10 - 90% of snowfall in the Colorado River Basin, while the remaining snowmelt provides over 80% of streamflow to the Colorado River <span class="citation" data-cites="lundquist_sublimation_2024">[@lundquist_sublimation_2024]</span>. Over half of streamflow from the Upper Colorado River basin comes from groundwater sources primarily recharged by snowmelt <span class="citation" data-cites="miller2016">[@miller2016]</span>. Therefore, small reductions in evaporative losses could have out-sized impacts on available water supplies, particularly enhancing groundwater recharge in terrains underlain by karst lithology <span class="citation" data-cites="hibbert1979 wyatt2013">[@hibbert1979; @wyatt2013]</span>.</p>
<p>** Papers on how thinning works primarily in snow-dominated systems**</p>
<p>This research aims to develop criteria for areas suitable for thinning to enhance groundwater recharge. It focuses primarily on regional studies to determine suitability criteria, which are likely the best predictor of hydrologic response to treatment <span class="citation" data-cites="wyatt_estimating_2013">[@wyatt_estimating_2013]</span>.</p>
<section id="regional-hydrologic-responses-to-treatment" class="level2">
<h2>Regional Hydrologic Responses to Treatment</h2>
<p>Several regional studies link forest treatment to changes in stand-level ecohydrology, including increased tree growth in Ponderosa Pines greater soil moisture and total ecosystem moisture leading to increased drought resilience <span class="citation" data-cites="sankey_regionalscale_2021 sankey_thinning_2022">[@sankey_regionalscale_2021; @sankey_thinning_2022]</span>, increased snow retention <span class="citation" data-cites="broxton_subseasonal_2023 belmonte2021">[@broxton_subseasonal_2023; @belmonte2021]</span>, greater streamflow <span class="citation" data-cites="baker_effects_1986">[@baker_effects_1986]</span>, water table rise <span class="math display">\[Denver et al in Prep \]</span>[<span class="citation" data-cites="smerdon_overview_2009">@smerdon_overview_2009</span>]<span class="citation" data-cites="schenk_impacts_2020">[@schenk_impacts_2020]</span> and increased springflow <span class="citation" data-cites="schenk_impacts_2020">[@schenk_impacts_2020]</span><span class="math display">\[Hart prarie and hoxworth in prep\]</span>.</p>
<section id="water-yieldrunoff" class="level3">
<h3>Water Yield/Runoff</h3>
<p>Several regional studies link forest treatment to increased streamflow <span class="citation" data-cites="dwivedi_how_2024 biederman_streamflow_2022 broxton_subseasonal_2023">[@dwivedi_how_2024; @biederman_streamflow_2022; @broxton_subseasonal_2023]</span>. However, there appears to be a threshold response, with water yield increasing only in treated forests receiving over 500mm of annual precipitation or in snow-dominated forests <span class="citation" data-cites="biederman_streamflow_2022 carroll_evaluating_2016 adams_ecohydrological_2012 zou_streamflow_2010 hibbert1979">[@biederman_streamflow_2022; @carroll_evaluating_2016; @adams_ecohydrological_2012; @zou_streamflow_2010; @hibbert1979]</span>.</p>
</section>
<section id="soil-moisture-and-drought-resilience" class="level3">
<h3>Soil Moisture and Drought Resilience</h3>
<p>A synthesis of several treatment types across Northern Arizona, including thinning at various levels and prescribed burning, found that treated sites had significantly greater total ecosystem moisture, making forests more resilient to drought<span class="citation" data-cites="sankey_regionalscale_2021 sankey_thinning_2022">[@sankey_regionalscale_2021; @sankey_thinning_2022]</span>. Treatments were shown to increase tree growth, improving resilience to drought in Ponderosa Pine forests<span class="citation" data-cites="rodman2024">[@rodman2024]</span>. Thinned Ponderosa Pine forests have higher soil moisture for two to eight years post-thinning, a result also found in semi-arid forests around the Mediterranean <span class="citation" data-cites="belmonte_soil_2022 del_campo_global_2022 odonnell_vegetation_2021 del_campo_effectiveness_2019">[@belmonte_soil_2022; @del_campo_global_2022; @odonnell_vegetation_2021; @del_campo_effectiveness_2019]</span>.</p>
</section>
<section id="justification" class="level3">
<h3>Justification</h3>
<ul>
<li><p>regional studies are the best predictor of hydrologic response to thinning in Arizona forests <span class="citation" data-cites="wyatt_estimating_2013">[@wyatt_estimating_2013]</span></p></li>
<li><p>A snythesis of all 4FRI treatments found that thinned and burned forests have signifiantly greater total ecosystem moisture and are thus more resilient to drought and wildfire <span class="citation" data-cites="sankey_regionalscale_2021">[@sankey_regionalscale_2021]</span></p></li>
<li><p>Thinned forests are better buffered against drought impacts in terms of both soil moisture and tree health <span class="citation" data-cites="sankey_thinning_2022">[@sankey_thinning_2022]</span>.</p></li>
<li><p>Soil moisture and ET may be affected by thinning for 3.6 - 8.6 years <span class="citation" data-cites="del_campo_global_2022">[@del_campo_global_2022]</span>.</p></li>
<li><p>Prescribed burning or thinning can increase tree growth, improving resilience to drought in ponderosa pine forests <span class="citation" data-cites="rodman2024">[@rodman2024]</span>.</p></li>
<li><p>Thinned forests (around Flagstaff) have higher soil moisture at 25 and 50cm in the first two years post-thinning <span class="citation" data-cites="belmonte_soil_2022">[@belmonte_soil_2022]</span>.</p></li>
<li><p>Thinning in semi-arid forests around the Mediterranean increased antecedent soil moisture and below ground hydrologic processes and increased deep soil moisture by 50mm/year over the control <span class="citation" data-cites="del_campo_effectiveness_2019">[@del_campo_effectiveness_2019]</span>.</p></li>
<li><p>a review of 35 studies published from 1971 to 2018 found that thinning was more effective than clear-cutting in terms of increasing groundwater recharge due to reduced sublimation and evaporation. Springs can effectively monitor groundwater recharge effects in arid lands <span class="citation" data-cites="schenk_impacts_2020">[@schenk_impacts_2020]</span>.</p></li>
<li><p>A review of studies on forest mgmt effects on groundwater resources found that a rise in the water table can generally be expected following forest thinning in all forested landscapes <span class="citation" data-cites="smerdon_overview_2009">[@smerdon_overview_2009]</span>.</p></li>
</ul>
<section id="snow-retention" class="level4">
<h4>Snow retention</h4>
<ul>
<li><p>The effects of forest thinning and subsequent snowmelt are highly variable, with responses depending on forest structure and local climate, where thinning in dense and taller vegetation generally increases snow retention, thinning in shorter, less dense forests may decrease retention <span class="citation" data-cites="lewis_prediction_2023">[@lewis_prediction_2023]</span>.</p></li>
<li><p>In semi-arid forested watersheds, thinning can influence streamflow variability by modifying snowpack accumulation and melt, particularly in wetter years where thinning can either reduce or increase snow retention based on site-specific conditions.<span class="citation" data-cites="broxton_subseasonal_2023">[@broxton_subseasonal_2023]</span>.</p></li>
<li><p>Thinning in semi-arid forested watersheds can significantly impact streamflow by altering snowmelt timing, with reduced forest cover tending to delay snowmelt at warmer sites while advancing melt at cooler, snowpack-persistent sites <span class="citation" data-cites="dwivedi_how_2024">[@dwivedi_how_2024]</span>.</p></li>
<li><p>Thinned forests around Flagstaff have greater snow persistence at 25%-35% canopy cover <span class="citation" data-cites="belmonte_uav-based_2021">[@belmonte_uav-based_2021]</span></p></li>
<li><p>Thinned forests in Northern Arizona have more snow and soil moisture <span class="citation" data-cites="odonnell_vegetation_2021">[@odonnell_vegetation_2021]</span></p></li>
<li><p>Found that thinned and burned vs. control forests had varying rates of snowmelt and snow persistence. Canopy cover is most predictive of snow persistence <span class="citation" data-cites="donager_integrating_2021">[@donager_integrating_2021]</span>.</p></li>
</ul>
</section>
<section id="thresholds-in-literature" class="level4">
<h4>Thresholds in literature</h4>
<ul>
<li><p>A review of 94 catchment studies showed that significant changes in water yield are correlated to forest growth in forests that receive 600-1200 mm of mean annual precipitation Bosch and Hewlett, 1982 The caveat being there were not many coniferous forests studies in that precipitation range <span class="citation" data-cites="bosch_review_1982">[@bosch_review_1982]</span>.</p></li>
<li><p><span class="citation" data-cites="adams_ecohydrological_2012">[@adams_ecohydrological_2012]</span> hypothesized that where annual precipitation exceeds ~500 mm or water yield is dominated by snowmelt, watershed will experience significantly decreased evapotranspiration and increased flows if canopy cover is reduced by over 20%. However, their recent observations suggest that in dry forests, water yield may decrease. More research is needed. This paper was focused on tree-die off not thinning.</p></li>
<li><p><span class="citation" data-cites="carroll_evaluating_2016">[@carroll_evaluating_2016]</span> found a threshold hydrologic response when evaluating the thinning of a snow-dominated semi-arid Pinyon-Juniper community in the Great Basin. They found that a positive water yield in thinned plots was only observed when precipitation exceeded 400mm annually (wet years)</p></li>
<li><p><span class="citation" data-cites="biederman_streamflow_2022">[@biederman_streamflow_2022]</span> suggests that disturbance will positively impact streamflow for a minimum of several years following disturbance in areas where mean annual precipitation exceeds ~500mm. “Presumably because below 500 mm, most precipitation is evaporated regardless of forest condition (Hibbert, 1979)<span class="math display">\[\@\]</span></p></li>
<li><p><span class="citation" data-cites="zhang_response_2001">[@zhang_response_2001]</span> evaluated 250 worldwide catchment studies and found that the differences in ET between forested and non-forested catchments diminish in areas with annual rainfall less than 500 mm</p></li>
</ul>
</section>
</section>
<section id="thinning-decreases-et-in-some-circumstances" class="level3">
<h3>thinning decreases ET in some circumstances</h3>
<ul>
<li><p>Reductions of canopy cover can increase ET of existing trees, and solar radiation increases ET <a href="Chen%20et%20al.,%202005;%20Bennett%20et%20al.,%202018">@biederman_recent_2015</a></p></li>
<li><p>Decreases in post-disturbance ET may be offset by increased soil evaporation, increasing net ET (Reed et al., 2016)</p></li>
<li><p><span class="citation" data-cites="goeking_forests_2020">[@goeking_forests_2020]</span> reviewed the hydrologic response of stand-replacing and non-stand-replacing disturbances and found that post-disturbance streamflow may increase, not change, or even decrease. Non-stand replacing fires—because of increased evaporation from higher sub-canopy radiation and increased transpiration from rapid post-disturbance growth can reduce water availability in some cases.</p></li>
</ul>
</section>
</section>
<section id="sec-data-methods" class="level2">
<h2>Data &amp; Methods</h2>
<section id="weighted-suitability-workflow" class="level3">
<h3>Weighted Suitability Workflow</h3>
<section id="define" class="level4">
<h4>Define</h4>
<blockquote>
<p>“define the goal, supporting criteria, and evaluation metrics for the weighted suitability model.”</p>
</blockquote>
<p><strong>Here we define the goal of this suitability map–to locate areas on the Mogollon Rim Ranger District in the Coconino National Forest where thinning may increase groundwater recharge based on modeling of criteria found in the literature quantifying the impact of thinning on water yield in Regional studies of Semi-arid forests.</strong></p>
</section>
<section id="suitability-criteria" class="level4">
<h4>Suitability Criteria</h4>
<section id="aspect" class="level5">
<h5>Aspect</h5>
<p>Aspect has a large impact on solar radiation.</p>
<blockquote>
<p>Closer to 0 or 360 is desired, low suitability scores for closeness</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="images/Aspect_suitability.PNG" class="img-fluid" /></p>
<figcaption>Screenshot of Transfer function for Aspect Suitability</figcaption>
</figure>
</div>
<hr />
</section>
<section id="slope" class="level5">
<h5>Slope</h5>
<p>Higher slopes are less suitable because thinning is both more expensive, and more precipitation will end up as runoff.</p>
<blockquote>
<p>Lower slopes have higher suitability scores</p>
</blockquote>
<p><img src="images/Slope_suitability.PNG" class="img-fluid" /></p>
<hr />
</section>
<section id="elevation" class="level5">
<h5>Elevation</h5>
<p>Water yield in lower elevation watersheds will be less responsive to changes in forest structure due to asynchrony between snowmelt and transpiration <span class="citation" data-cites="biederman2022">[@biederman2022]</span></p>
<p>Winter precipitation mainly falls as snow at elevations above 1800m in Arizona <span class="citation" data-cites="friederici2013">[@friederici2013]</span></p>
<hr />
</section>
<section id="precipitation" class="level5">
<h5>Precipitation</h5>
<blockquote>
<p><strong>Ideal:</strong> Mean annual precipitation must be higher than 500mm 1990 - 2020</p>
<p><strong>Marginal:</strong> (benefits only expected in wet years or during some events) Max precipitation higher than 500mm but Mean annual precipitation &lt; 500mm</p>
<p><strong>Unsuitable:</strong> Max annual precipitation &lt; 500mm</p>
</blockquote>
<p><img src="images/Precipitation_suitability.PNG" class="img-fluid" /></p>
<hr />
</section>
<section id="vegetation-characteristics" class="level5">
<h5>Vegetation Characteristics</h5>
<p>Reconstructions of pre-settlement ponderosa pine forests have found a range of canopy covers between 10 - 22%, with a median of 16.7% canopy cover <span class="citation" data-cites="huffman2012">[@huffman2012]</span>. However, remote sensing studies of snow extent found that canopy covers of 24 - 35% yield the ideal conditions for maintaining snow cover <span class="citation" data-cites="sankey2015 belmonte2021a">[@sankey2015; @belmonte2021a]</span>. Which means that restoring forests to pre-settlement canopy cover percentages may not be the ideal canopy cover for maintaining snowpack, the dominant source of groundwater recharge snow-dominant forest of Arizona.</p>
<p>Reductions in canopy cover of at least 20% are likely required to see a meaningful decrease in evapotranspiration <span class="citation" data-cites="adams2012">[@adams2012]</span>.</p>
<p>Because thinning is costly, and soil compaction from thinning operations can adversely affect infiltration rates, we view a 20% reduction as the ideal canopy reduction to minimize cost and impact while meaningfully reducing ET. A 20% reduction in canopy cover with a starting canopy cover of 20%, yields a thinned canopy cover of 16% canopy cover, the median for pre-settlement forests, but probably on the low end for what is ideal for maintaining snowcover, therefore we consider all areas with forest cover below 21% as unsuitable.</p>
<p>In order to maximize snow cover while reducing the canopy cover by 20%, we consider the ideal range of final canopy cover between 24% - 35%, meaning the most suitable areas for thinning to maximize snow retention would be forests with between 30% and 44%, with declining suitability as the canopy cover deviates from that range. The function to convert canopy cover then to suitability (1-10) is shown in equation <a href="#eq-cc-suitability" class="quarto-xref">Equation 1</a>.</p>
<p><span id="eq-cc-suitability"><span class="math display">\[y =\begin{cases} 10 \cdot \left(1 - \left(\frac{x - 37}{16 - 37}\right)^2\right),&amp; \text{if } x &lt; 37 \text{ and } x &gt; 16, \\10 \cdot \left(1 - \left(\frac{x - 37}{80 - 37}\right)^2\right), &amp; \text{if } x \geq 37 \text{ and } x &lt; 80, \\0, &amp; \text{if } x \leq 16 \text{ or } x \geq 80.\end{cases} \tag{1}\]</span></span></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img src="scraps_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<blockquote>
<p><strong>Dataset: NLCD 2021 Total Canopy Cover (% Cover)</strong></p>
</blockquote>
</section>
<section id="soil-hydrologic-conditions" class="level5">
<h5>Soil Hydrologic Conditions</h5>
<p>Soil types A,B,C,D are mapped for the USA, There are no A soil types in the study area, so they were given the following suitability values</p>
<p>B = 10 out of 10 C = 8 out of 10 D = 3 out of 10</p>
<p><img src="images/SoilHydrologicGroup_suitability.PNG" class="img-fluid" /></p>
</section>
</section>
</section>
</section>
<section id="preliminary-results" class="level2">
<h2>Preliminary Results</h2>
<section id="weighting" class="level3">
<h3>Weighting</h3>
<p>Tree Canopy Cover = 20% Vegetation Condition Class = 20% Slope = 20% Aspect = 20% Max Precipitation = 15% Soil Hydrologic Group = 5%</p>
</section>
<section id="overall-suitability" class="level3">
<h3>Overall Suitability</h3>
<p><img src="images/PreliminarySuitabilityMap.PNG" class="img-fluid" /></p>
<hr />
</section>
</section>

</main>
<!-- /main column -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->

</body>

</html>
